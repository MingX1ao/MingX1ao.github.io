<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
    <meta charset="UTF-8">
    <meta name="keywords" content="气道分割方法文献精读">
    <meta name="description" content="Learning Bronchiole-Sensitive Airway Segmentation CNNs by Feature Recalibration and Attention Distillation - 气道分割方法文献精读">
    <meta name="author" content="MingXiao">
    <title>Learning Bronchiole-Sensitive Airway Segmentation CNNs by Feature Recalibration and Attention Distillation</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/assets/css/pace-theme-flash.css">
    <link rel="stylesheet" href="/assets/css/d-audio.css">
    <link rel="stylesheet" href="/assets/css/article-detail.css">
    <link rel="stylesheet" href="/assets/css/code.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/vditor.css">
    <link rel="stylesheet" href="/assets/css/markdown.css">
    <link rel="shortcut icon" href="/images/blog-logo.png">
    <style>
        .lazy-image {
            background: url('/images/loading.gif') no-repeat center;
            background-size: 26% 35%;
            height: 100%;
            width: 100%;
        }

        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 10px;
        }

        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }

            .markdown-body h1 {
                font-size: 1.35em;
            }

        }

        .codehilite {
            border-radius: 10px;
        }

        .article-content img {
            max-width: 100%;
        }

        #outerdiv {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 200;
        }
    </style>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <script src="/assets/js/include.js"></script>
    <div data-include="/includes/nav.html"></div>
        <div class="toc">
            <ul>
                <li>Learning Bronchiole-Sensitive Airway Segmentation CNNs by Feature Recalibration and Attention Distillation
                    <ul>
                            <li><a href="#4.1">1 Introduction</a></li>
                            <li><a href="#4.2">2 Method</a></li>
                            <li><a href="#4.3">3 Setup</a></li>
                    </ul>
                </li>
            </ul>
        </div>

    <!--主体-->
    <section class="main">
        <div class="left-box">
            <div id="outerdiv">
                <div id="innerdiv" style="position:absolute;"><img alt id="bigimg"
                        style="box-shadow: 0 0 10px rgba(0,0,0,0.38)" src="" /></div>
            </div>
            <!--文章内容-->
            <div class="article-container">
                <div class="article-content markdown-body">
                    <h1 style="margin: 10px 0">Learning Bronchiole-Sensitive Airway Segmentation CNNs by Feature Recalibration and Attention Distillation</h1>
                    <div class="article-cate">
                        <a href="/Category/LearningHomepage.html">文章阅读</a>
                    </div>
                    <div class="writer-info">
                        <span style="margin: 5px 0;">作者: </span>
                        <span id="writer">MingXiao</span>
                    </div>
                    <div class="typora-export os-windows">
<p>MICCAI <a href="https://doi.org/10.1007/978-3-030-59710-8_22">https://doi.org/10.1007/978-3-030-59710-8_22</a></p>
<p>用注意力蒸馏机制在气管末梢加上更大的全局对齐权重</p>
<hr>
<a name="4.1" class="md-header-anchor" id="4.1"></a>
<h3>1 Introduction</h3>
<p>本文提出的是基于CNN的模型，主要有</p>
<ul>
<li>重校准模块，充分利用已经学习的特征<ul>
<li>减少通道数来防止过拟合</li>
<li>防止参数减少使学习能力下降</li>
<li>这个重校准模块用的就是注意力子层</li>
</ul>
</li>
<li>使用了蒸馏机制，用高分辨率的注意力图（有更多上下文）来细化低分辨率的注意力图；同时蒸馏作为辅助监督，提供了额外的监督信号</li>
</ul>
<p>模型结构如下</p>
<center><img src="/Category/Learning/Pictures/airway_6.png"></center>

<p>其中IN表示instance normalization</p>
<a name="4.2" class="md-header-anchor" id="4.2"></a>
<h3>2 Method</h3>
<p>输入的三维图像\(X\)经过模型作用后得到\(P\)，\(P=\mathcal{F}(X)\)，代表每个体素是气道的概率；gt值是\(Y\)，一个是否为气管的Boolean掩膜</p>
<p>假定每一个卷积层的输出为\(A_m,m=1,...,M\)，\(M\)是卷积层的个数</p>
<p><strong>特征重新校准</strong></p>
<p>使用一个映射\(Z(\cdot)\)，生成通道描述算子\(U_m\)，将其与\(A_m\)做\(A_m\odot U_m\)，相当于一个权重</p>
<p>因为不同位置在\(A_m\)内部和\(A_i\)之间的重要性不同，简单地池化对精细/粗糙的气管特征没有区分能力</p>
<p>映射\(Z(\cdot)\)可以描述为</p>
<center><img src="/Category/Learning/Pictures/airway_7.png" width="500"></center>

<p>其中\(\mathcal{B}(\cdot)\)表示广播；\(h_i, d_i, w_i\)都是可以学习的权重，在训练时不同的卷积层会对重要的区域产生偏好</p>
<p>为了产生\(Z(A_m)\)，使用下面的计算公式<br>\[
U_m = Z(A_m) = f_2(K_2*f_1(K_1*\mathcal{Z}_{spatial}(A_m)))
\]<br>其中\(K_1,K_2\)分别是1*1*1的卷积核，*表示卷积，f1是ReLU，f2是Sigmoid</p>
<p>使用\(K_1\)卷积后通道数被压缩为\(\frac{1}{r}\)，通过调整\(K_1\)的第四维大小调整压缩比r，使用\(K_2\)卷积后通道数恢复</p>
<p>最终得到校准后的特征<br>\[
\hat{A} = A\odot U
\]</p>
<p><strong>注意力蒸馏</strong></p>
<p>注意力蒸馏在两个连续的卷积层之间进行，首先需要得到本层的注意力图<br>\[
G_m = G(A_m)
\]<br>其中注意力仅单通道，每个体素反应了\(A_m\)中对应体素在分割模型时的贡献，计算方法为<br>\[
G_m = \sum_{c=1}^{C_m}|A_m[c,:,:,:]|^p
\]<br>是一个没开根的L-P范数，\(p>1\)，则会更关注高激活区域</p>
<p>这里用求和而不是最值/均值，可以减少描述整体特征的偏差（保留细节）</p>
<p>然后使用三线性插值\(I(\cdot)\)和空间级Softmax\(S(\cdot)\)来处理\(G_m\)，得到\(\hat{G_m}=S(I(G_m))\)，这一步处理是为了进行注意力蒸馏<br>\[
L_{\mathsf{distill}}=\sum_{m=1}^{M-1}\| \hat{G}_m-\hat{G}_{m+1} \|^2_F
\]<br>其中\(\|  \|_F^2\)表示平方佛罗贝尼乌斯范数，相当于\(\|\|^2_2\)</p>
<p>蒸馏后的注意力\(G_m\)更接近\(G_{m+1}\)，视觉注意力从最深层传递到最浅层，在模型拥有注意力的地方，越深层的特征是越高频的</p>
<p>为了保证蒸馏的方向从后向前，需要将\(\hat{G}_{m+1}\)从计算图中分离，因此，反向传播的梯度不会改变\(\hat{G}_{m+1}\)的值</p>
<p><strong>模型设计</strong></p>
<p>还是沿用了U-net的架构，卷积核都是3*3*3的</p>
<p>Encoder层没有使用注意力和蒸馏，因为特征太低维，与气道的描述无关</p>
<p><strong>损失函数</strong></p>
<p>结合了Dice和Focal Loss<br>\[
L_{seg} = -\left( \frac{2\sum_{x\in X}p(x)y(x)}{\sum_{x\in X}(p(x)+y(x))+\varepsilon} \right) - \frac{1}{|X|}\left( \sum_{x\in X}(1-p_t(x))^2\log(p_t(x)) \right)
\]<br>其中\(y(x)\)是体素\(x\)的真实标签，\(p(x)\)是预测值，\(p_t(x) =\begin{cases} p(x)\,\,,\,\,y(x)=1 \\ 1-p(x)\,\,,\,\,o.w.\end{cases}\)</p>
<p>前文还有蒸馏损失，整体损失函数为二者的线性组合<br>\[
L = L_{seg} + \alpha L_{distill}
\]</p>
<a name="4.3" class="md-header-anchor" id="4.3"></a>
<h3>3 Setup</h3>
<ul>
<li>预处理见AirwayNet</li>
<li>Adam optimizer设置参数\(\beta_1=0.5,\beta_2=0.999\)，学习率设置\(2\times 10^{-4}\)</li>
<li>大图像用48的步长分块，重叠取均值，最终以0.5为阈值</li>
<li>不做后处理</li>
<li>超参数设置：\(\alpha=0.1, \varepsilon=10^{-7},p=2,r=2\)</li>
</ul>

                    </div>    
                </div>
            </div>                                                                                                                                              
            <br>
            <br>
            <h2 id="__comments">Comments</h2>
                  <!-- Giscus comments -->
                    <script src="https://giscus.app/client.js"
                            data-repo="MingX1ao/MingX1ao.github.io"
                            data-repo-id="R_kgDOL_cJHA"
                            data-category="General"
                            data-category-id="DIC_kwDOL_cJHM4CgVLq"
                            data-mapping="pathname"
                            data-strict="0"
                            data-reactions-enabled="1"
                            data-emit-metadata="0"
                            data-input-position="bottom"
                            data-theme="light"
                            data-lang="zh-CN"
                            data-loading="lazy"
                            crossorigin="anonymous"
                            async>
                    </script>
        </div>
    </section>
    <!--尾部-->
    <div data-include="/includes/footer.html"></div>
    <script>
        document.addEventListener('includesReady', function() {
            const lazyImage = new LazyImage('.lazy-image');
        });
    </script>
</body>

</html>
