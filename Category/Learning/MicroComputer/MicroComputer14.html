<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
    <meta charset="UTF-8">
    <meta name="keywords" content="微机原理">
    <meta name="description" content="15 补充 - 微机原理">
    <meta name="author" content="MingXiao">
    <title>15 补充</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="stylesheet" href="/assets/css/global.css">
    <link rel="stylesheet" href="/assets/css/pace-theme-flash.css">
    <link rel="stylesheet" href="/assets/css/d-audio.css">
    <link rel="stylesheet" href="/assets/css/article-detail.css">
    <link rel="stylesheet" href="/assets/css/code.css">
    <link rel="stylesheet" href="/assets/css/github-markdown.css">
    <link rel="stylesheet" href="/assets/css/vditor.css">
    <link rel="stylesheet" href="/assets/css/markdown.css">
    <link rel="shortcut icon" href="/images/blog-logo.png">
    <style>
        .lazy-image {
            background: url('/images/loading.gif') no-repeat center;
            background-size: 26% 35%;
            height: 100%;
            width: 100%;
        }

        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 10px;
        }

        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }

            .markdown-body h1 {
                font-size: 1.35em;
            }

        }

        .codehilite {
            border-radius: 10px;
        }

        .article-content img {
            max-width: 100%;
        }

        #outerdiv {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 200;
        }
    </style>
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <script src="/assets/js/include.js"></script>
    <div data-include="/includes/nav.html"></div>
        <div class="toc">
            <ul>
                <li>15 补充
                    <ul>
                            <li><a href="#14.1">15.1 求整数平方根</a></li>
                            <li><a href="#14.2">15.2 冒泡排序</a></li>
                            <li><a href="#14.3">15.3 小tips</a></li>
                    </ul>
                </li>
            </ul>
        </div>

    <!--主体-->
    <section class="main">
        <div class="left-box">
            <div id="outerdiv">
                <div id="innerdiv" style="position:absolute;"><img alt id="bigimg"
                        style="box-shadow: 0 0 10px rgba(0,0,0,0.38)" src="" /></div>
            </div>
            <!--文章内容-->
            <div class="article-container">
                <div class="article-content markdown-body">
                    <h1 style="margin: 10px 0">15 补充</h1>
                    <div class="article-cate">
                        <a href="/Category/LearningHomepage.html">学习笔记</a>
                    </div>
                    <div class="writer-info">
                        <span style="margin: 5px 0;">作者: </span>
                        <span id="writer">MingXiao</span>
                    </div>
                    <div class="typora-export os-windows">
<p>神人sgf的迷惑出题</p>
<a name="14.1" class="md-header-anchor" id="14.1"></a>
<h3>15.1 求整数平方根</h3>
<p>数学原理是\(n^2 = \sum_{i=0}^{n-1} 2i+1\)，那么用\(\sum 2i+1\)和\(n^2\)比大小，正好相等时的\(i=n-1\)，代码如下</p>
<pre><code class="language-assembly">SQRT PROC NEAR
	push ax
	push bx
	push cx
	
	mov ax, si		;取n2
	sub cx, cx		;cx=0,同时让FLAGS置零
again:
	mov bx, cx		;bx=i
	add bx, bx
	inc bx			;bx=2i+1
	sub ax, bx		
	jc over			;存在借位，说明ax&lt;bx，就结束
	inc cx
	jmp again		;ax&gt;bx就继续
over:			
	mov si, cx
	pop cx
	pop bx
	pop ax
	ret
SQRT ENDP
</code></pre>
<a name="14.2" class="md-header-anchor" id="14.2"></a>
<h3>15.2 冒泡排序</h3>
<p>算法就是一次次冒泡，一共n个数，就有n-1+n-2+...+1次交换，也就是两层循环，外层n-1次，内层n-i次（从1开始），代码如下</p>
<pre><code class="language-assembly">start:
	mov ax, data		;存放要排的数据
	mov ds, ax
	mov cx, n-1			;n个数排序
LP1:
	mov di, cx			;di就是j,j=n-i
	mov bx, 0			;寻址用
LP2:
	mov al, table[bx]
	cmp al, table[bx+1]	;两个数比较
	jge	next			;这里的排序方法是从大到小，所以是ge
	xchg al, table[bx+1]	;不是就交换两个数，这个是交换的代码
	mov table[bx], al
next:
	inc bx				;下一对数据
	dec di				;内层循环-1
	jnz LP2
	loop LP1			;外层循环-1
</code></pre>
<a name="14.3" class="md-header-anchor" id="14.3"></a>
<h3>15.3 小tips</h3>
<ul>
<li><p><code>in, out</code>指令只能用<code>ax, al</code>存放读/写的数据，16bit用<code>ax</code>，8bit用<code>al</code></p>
</li>
<li><p>USART: Universal Synchronous/Asynchronous Receiver/Transmitter 通用同步/异步数据收发器</p>
</li>
<li><p>在8251A异步初始化中，需要多次向端口写0，详见复习ppt第60页</p>
</li>
<li><p>异步串行通讯的数据规格：起始位1b；数据位5-8b，D0在先；奇偶校验位1b；停止位1/1.5/2b</p>
</li>
<li><p>8253的方式1，方式3，方式5比较重要</p>
</li>
<li><p><font color=red><strong>DOS系统的启动</strong></font></p>
</li>
<li><p>冷启动是从完全断电状态开始，电源上电后产生复位信号，BIOS执行POST（Power On Self Test）进行全面硬件检测和初始化，并加载引导程序启动操作系统内核。热启动是在计算机已开启状态下，通过特定按键组合或系统选项触发，发送复位信号使CPU等硬件复位，但不重新上电，BIOS仅对部分硬件简单检测，操作系统关闭程序后重新加载内核并尝试恢复用户环境，速度比冷启动快。</p>
</li>
<li><p>冷启动：电源重新打开，整个系统初始化</p>
<ol>
<li><p>清理内存</p>
</li>
<li><p>检查内存</p>
</li>
<li><p><code>CS = FFFFH</code></p>
</li>
<li><p><code>IP = 0000H</code>，3/4一起将指令指向了BIOS</p>
</li>
<li><p>BIOS检查端口，识别和初始化设备</p>
</li>
<li><p>BIOS 建立两个数据区：从<code>0000H</code>开始的中断向量区；BIOS数据区</p>
</li>
<li><p>BIOS 加载系统文件</p>
</li>
</ol>
</li>
<li><p>热启动：跳过自检，不会清空内存</p>
<ul>
<li>复位启动reset：复位，见8.2节RESET引脚</li>
</ul>
</li>
<li><p>程序段前缀（PSP，Program Segment Prefix）</p>
<ul>
<li>加载子程序时在程序占用的内存前256个Byte中，含有程序返回，文件名等信息</li>
<li>PSP的地址默认作为<code>DS, ES</code>的值，故不加指定，则<code>CS = DS +10H</code>（<code>256D = 100H</code>）</li>
</ul>
</li>
<li><p><code>TEST</code>指令，改变<code>SF/ZF/PF</code>，<code>OF = CF = 0</code></p>
<ul>
<li><code>TEST reg1/opr1, reg2/opr2</code>，按位进行与操作，只改变<code>FLAGS</code>不改变操作数</li>
<li>当两个都是0时，结果是0</li>
</ul>
</li>
<li><p><code>INT 21H</code></p>
<ul>
<li>2号功能<ul>
<li>字符显示功能，功能号存在<code>MOV ah, 02H</code>中；输入<code>MOV dl, char</code>，是字符的ASCII码</li>
</ul>
</li>
<li>9号功能<ul>
<li>字符串显示功能，<code>MOV ah, 09H</code>，<code>DS:DX</code>指向一个以<code>$</code>结尾的字符串，显示这个字符串</li>
</ul>
</li>
<li>0A号功能<ul>
<li>键盘输入存放到缓冲区（包括回车，回车是输入结束标志），<code>MOV ah, 0AH</code>，<code>DS:DX</code>指向缓冲区</li>
<li>缓冲区第一个字节是用户预先定义的缓冲区大小（1-255），第二个字节是DOS系统写的读取的字符数</li>
</ul>
</li>
</ul>
</li>
<li><p>显示数字的那个实验题，《微机原理实验》的10.3节</p>
</li>
<li><p>传统总线结构，见复习ppt第67页</p>
</li>
<li><p><code>PUSHA</code>指令，依次压入<code>AX, CX, DX, BX, SP, BP, SI, DI</code>，然后<code>SP -= 16</code>；<code>POPA</code>返回所有</p>
</li>
<li><p>压缩的BCD码：用4bit binary表示1bit decimal；非压缩：用8bit binary，其中高四位都是0</p>
<ul>
<li>数字的ASCII码是非压缩的BCD码：0 - 0011 0000 = 30H = 48D；9 - 0011 1001</li>
</ul>
</li>
<li><p>中断和DMA比较</p>
<ul>
<li>中断：在CPU执行完一条指令后响应；通过中断服务程序（保护和恢复寄存器）；可由软/硬件引起</li>
<li>DMA：在CPU执行完一个总线周期后响应；传送1B只需要1~2个总线周期；可有软/硬件引起</li>
</ul>
</li>
<li><p>无论是<code>jmp dword ptr</code>，<code>call far ptr</code>，在保存或设置<code>CS:IP</code>时，都是<code>IP</code>的地址更低，在机器码中也是<code>IP</code>编译得更低</p>
</li>
<li><p><code>XLAT</code>指令将<code>ds:[bx+al]</code>地址的内容存放到<code>al</code>寄存器中，一般而言<code>bx</code>是某个表的偏移地址，<code>al</code>原始值则是需要的值在表中的偏移，在使用直接定址表时比较方便（我在努力帮神人sgf说话了，学这指令干嘛？）</p>
</li>
<li><p><code>REPZ/E, REPNZ/E</code>和<code>REP</code>类似，但是多一个检查<code>ZF</code>的状态，前者在相等时继续，后者在不等时继续，搭配<code>CMPSB/W</code>（对比<code>es:[di]</code>和<code>ds:[si]</code>的字节/字）和<code>SCASB/W</code>（查找<code>al/ax</code>，从内存地址<code>es:[di]</code>开始）</p>
</li>
</ul>

                    </div>    
                </div>
            </div>                                                                                                                                              
            <br>
            <br>
            <h2 id="__comments">Comments</h2>
                  <!-- Giscus comments -->
                    <script src="https://giscus.app/client.js"
                            data-repo="MingX1ao/MingX1ao.github.io"
                            data-repo-id="R_kgDOL_cJHA"
                            data-category="General"
                            data-category-id="DIC_kwDOL_cJHM4CgVLq"
                            data-mapping="pathname"
                            data-strict="0"
                            data-reactions-enabled="1"
                            data-emit-metadata="0"
                            data-input-position="bottom"
                            data-theme="light"
                            data-lang="zh-CN"
                            data-loading="lazy"
                            crossorigin="anonymous"
                            async>
                    </script>
        </div>
    </section>
    <!--尾部-->
    <div data-include="/includes/footer.html"></div>
    <script>
        document.addEventListener('includesReady', function() {
            const lazyImage = new LazyImage('.lazy-image');
        });
    </script>
</body>

</html>
